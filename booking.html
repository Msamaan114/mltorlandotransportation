<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Booking Details &amp; Contact | MLT Orlando Transportation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Share your trip details with MLT Orlando Transportation so we can confirm your booking and send the correct Square payment link for your route."
  />
  <meta property="og:title" content="Booking Details &amp; Contact | MLT Orlando Transportation" />
  <meta
    property="og:description"
    content="Book private transportation in Orlando, Windermere, Lake Buena Vista, Golden Oak, Winter Park, I-Drive, SeaWorld and Port Canaveral."
  />
  <meta property="og:image" content="https://www.mltorlandotransportation.com/suv-front-main.jpeg" />
  <meta property="og:url" content="https://www.mltorlandotransportation.com/booking.html" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Top contact bar -->
  <div class="top-bar">
    <div class="top-bar-inner">
      <span>Private Orlando transportation from MCO &amp; SFB to Disney, Universal &amp; Cape Canaveral.</span>

      <div class="top-bar-right">
        <span>
          Call: <a href="tel:14073690643">407-369-0643</a> ·
          Email: <a href="mailto:mltorlando@yahoo.com">mltorlando@yahoo.com</a>
        </span>

        <div class="social-top">
          <a href="https://facebook.com/" target="_blank" rel="noopener">
            <img src="facebook-icon.jpeg" alt="Facebook" />
          </a>
          <a href="https://wa.me/14073690643" target="_blank" rel="noopener">
            <img src="whatsapp-icon.jpeg" alt="WhatsApp" />
          </a>
          <a href="https://www.instagram.com/mltorlando?igsh=ODV0Y2pocXJ0bjk4" target="_blank" rel="noopener">
            <img src="instagram-icon.jpeg" alt="Instagram" />
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Header / nav -->
  <header>
    <div class="nav">
      <a href="index.html" class="logo" style="text-decoration:none;">MLT Orlando Transportation</a>
      <nav>
        <a href="index.html">Home</a>
        <a href="services.html">Services</a>
        <a href="owner.html">Owner</a>
        <a href="private-airport.html">Private Airport</a>
        <a href="child-seats.html">Child Seats</a>
        <a href="service-areas.html">Service Areas</a>
        <a href="rates.html">Rates</a>
        <a href="cancellation.html">Cancellation</a>
        <a href="why-us.html">Why Us</a>
        <a href="booking.html">Booking</a>
      </nav>
    </div>
  </header>

  <main>
    <section id="contact">
      <a
        href="rates.html"
        class="btn-primary"
        style="text-decoration:none; display:inline-block; margin-bottom:1.5rem;"
      >
        ← Back to Rates &amp; Booking
      </a>

      <h2>Booking Details &amp; Contact</h2>
      <p class="section-intro">
        For trips <strong>within 8 hours</strong>, this form sends us a <strong>request</strong> and we must confirm
        availability before you pay. <br />
        For trips <strong>more than 8 hours away</strong>, you can submit this form and then proceed to pay with Square
        for the selected option.
      </p>

      <div class="contact-wrapper">
        <!-- LEFT -->
        <div>
          <form
            id="booking-form"
            action="https://formspree.io/f/xovgzajo"
            method="POST"
          >
            <!-- Hidden field to send selected route / vehicle / price / timing info -->
            <input
              type="hidden"
              id="selected-option"
              name="Selected route / vehicle / price / timing"
              value=""
            />

            <!-- Optional: for Formspree readability -->
            <input type="hidden" id="child-seats-summary" name="Child seats summary" value="" />

            <label for="name">Passenger name</label>
            <input id="name" name="Passenger name" type="text" placeholder="Full name" required />

            <label for="email">Email (same as payment)</label>
            <input id="email" name="Email" type="email" placeholder="you@example.com" required />

            <label for="phone">Mobile / WhatsApp number</label>
            <input id="phone" name="Phone" type="tel" placeholder="+1 407-369-0643" required />

            <label for="pickup-date">Pickup date</label>
            <input id="pickup-date" name="Pickup date" type="date" required />

            <label for="pickup-time">Pickup time (local)</label>
            <input id="pickup-time" name="Pickup time" type="time" required />

            <p id="timing-banner" class="hero-note" style="margin-top:0.75rem;">
              Once you select your pickup date and time, we’ll tell you if this is a short-notice request (&lt; 8 hours) or a standard booking (≥ 8 hours).
            </p>

            <!-- ROUTE / VEHICLE / TRIP TYPE SELECTION (AFTER TIME) -->
            <div id="route-vehicle-card" class="card" style="margin:1.25rem 0; display:none;">
              <h3>Select Your Route &amp; Vehicle</h3>

              <label for="route">Route / Area</label>
              <select id="route">
                <option value="">Select a route</option>
                <option value="MCO_DISNEY">MCO ↔ Disney / Universal / I-Drive / SeaWorld area</option>
                <option value="MCO_PORT">MCO ↔ Cape Canaveral / Port Canaveral</option>
                <option value="SFB_DISNEY">SFB ↔ Disney / Universal / I-Drive / SeaWorld area</option>
                <option value="HOURLY">Hourly service within Orlando (SUV)</option>
                <option value="CUSTOM">Other / custom route (we will confirm price by email)</option>
              </select>

              <label for="vehicle">Vehicle type</label>
              <select id="vehicle">
                <option value="">Select a vehicle</option>
                <option value="SEDAN">Sedan (up to 3 passengers)</option>
                <option value="SUV">SUV (up to 5 passengers)</option>
                <option value="VAN8">8-passenger van</option>
                <option value="VAN14">14-passenger van</option>
              </select>

              <label for="trip-type">Trip type</label>
              <select id="trip-type">
                <option value="">Select trip type</option>
                <option value="ONEWAY">One-way</option>
                <option value="ROUND">Round trip</option>
                <option value="HOURLY">Hourly (3-hour minimum)</option>
              </select>

              <div class="card" style="margin-top:1rem; background:#f9fafb;">
                <p id="price-text" class="hero-note" style="margin-bottom:0;">
                  Select your route, vehicle and trip type to see the price and payment instructions.
                </p>
              </div>
            </div>

            <label for="pickup-location">Pickup location</label>
            <select id="pickup-location" name="Pickup location" required>
              <option value="">Select an option</option>
              <option>MCO - Orlando International Airport</option>
              <option>SFB - Orlando Sanford International Airport</option>
              <option>Disney / Lake Buena Vista / Bay Lake</option>
              <option>Universal / I-Drive / Convention Center area</option>
              <option>SeaWorld area</option>
              <option>Windermere</option>
              <option>Golden Oak</option>
              <option>Winter Park</option>
              <option>Private airport / FBO</option>
              <option>Residence / Rental home</option>
              <option>Other (see notes)</option>
            </select>

            <label for="flight">Airline &amp; flight number (if flying)</label>
            <input
              id="flight"
              name="Airline &amp; flight number"
              type="text"
              placeholder="Example: Delta 1234"
            />

            <label for="destination">Destination address / hotel</label>
            <input
              id="destination"
              name="Destination"
              type="text"
              placeholder="Hotel name or full address"
              required
            />

            <label for="passengers">Number of passengers</label>
            <input
              id="passengers"
              name="Passengers"
              type="number"
              min="1"
              max="14"
              placeholder="2 adults, 2 children"
              required
            />

            <label for="luggage">Luggage details</label>
            <input
              id="luggage"
              name="Luggage"
              type="text"
              placeholder="e.g. 3 large suitcases, 2 carry-ons, 1 stroller"
            />

            <!-- CHILD SEATS REPEATER -->
            <label>Child seats (add what you need)</label>

            <div id="seat-rows">
              <div class="seat-row" style="display:grid; grid-template-columns:1fr 90px 40px; gap:0.5rem; align-items:center;">
                <select class="seat-type" name="Child seat type[]" aria-label="Seat type">
                  <option value="">Select seat type</option>
                  <option value="Rear-facing infant seat">Rear-facing infant seat</option>
                  <option value="Forward-facing car seat">Forward-facing car seat</option>
                  <option value="Booster seat">Booster seat</option>
                </select>

                <select class="seat-qty" name="Child seat quantity[]" aria-label="Quantity">
                  <option value="">#</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                </select>

                <button type="button" class="seat-remove btn-secondary" aria-label="Remove seat selection" style="display:none; padding:0.4rem 0.6rem;">
                  ×
                </button>
              </div>
            </div>

            <button type="button" id="add-seat-row" class="btn-secondary" style="margin-top:0.6rem;">
              + Add another seat type
            </button>

            <p class="hero-note" style="margin-top:0.6rem;">
              Example: add “Rear-facing infant seat = 1”, then press + to add “Booster seat = 2”.
            </p>

            <!-- RETURN DETAILS (shown ONLY when Trip type = Round trip) -->
            <div id="return-details-card" class="card" style="margin-top:1.25rem; display:none;">
              <h3 style="margin-top:0;">Return trip details</h3>
              <p class="hero-note" style="margin-top:-0.25rem;">
                Fill this out only if you selected <strong>Round trip</strong>.
              </p>

              <label for="return-from">Return pickup (from where?)</label>
              <input
                id="return-from"
                name="Return pickup location"
                type="text"
                placeholder="e.g. Disney resort / hotel name / address"
              />

              <label for="return-to">Return destination (to where?)</label>
              <input
                id="return-to"
                name="Return destination"
                type="text"
                placeholder="e.g. MCO / SFB / Port Canaveral / address"
              />

              <label for="return-date">Return date</label>
              <input id="return-date" name="Return date" type="date" />

              <label for="return-time">Return pickup time (local)</label>
              <input id="return-time" name="Return pickup time" type="time" />

              <label for="return-notes">Return trip comments</label>
              <textarea
                id="return-notes"
                name="Return trip comments"
                placeholder="Anything we should know for the return (airline/flight, meeting point, special requests...)"
              ></textarea>
            </div>

            <label for="notes">Additional notes</label>
            <textarea
              id="notes"
              name="Notes"
              placeholder="Child ages and approximate weights, flight info, special requests, gate meeting instructions..."
            ></textarea>

            <!-- ONE BUTTON ONLY -->
            <button id="submit-btn" type="submit" class="btn-primary">Submit booking request</button>

            <div id="form-status" class="hero-note" style="margin-top:0.75rem; display:none;"></div>

            <p class="hero-note" style="margin-top:0.75rem;">
              If your trip is <strong>within 8 hours</strong>, this will be treated as a
              <strong>short-notice request</strong> and we will confirm availability before you pay. <br />
              If your trip is <strong>more than 8 hours away</strong>, after you submit, you can complete payment
              (if a Square link is available for your selected option).
            </p>
          </form>
        </div>

        <!-- RIGHT -->
        <div class="contact-details">
          <p class="contact-label">Need help before booking?</p>
          <p>Phone: <a href="tel:14073690643"><strong>407-369-0643</strong></a></p>
          <p>Email: <a href="mailto:mltorlando@yahoo.com"><strong>mltorlando@yahoo.com</strong></a></p>
          <p>
            WhatsApp:
            <a href="https://wa.me/14073690643" target="_blank" rel="noopener">
              <strong>Message on WhatsApp</strong>
            </a>
          </p>

          <p class="contact-label" style="margin-top:1rem;">Typical hours</p>
          <p>Transportation: 24/7 by reservation</p>
          <p>Messages &amp; quotes: Every day, 8:00 – 20:00 (local time)</p>

          <p class="contact-label" style="margin-top:1rem;">Base location</p>
          <p>
            MLT Orlando Transportation<br />
            Orlando, FL<br />
            United States
          </p>

          <p class="hero-note" style="margin-top:1rem;">
            If your exact route isn’t listed in the dropdown, choose
            <strong>Other / custom route</strong> and describe your trip in the notes section. We’ll confirm the
            price and send the correct Square payment link.
          </p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="social-links">
      <a href="https://facebook.com/" target="_blank" rel="noopener">
        <img src="facebook-icon.jpeg" alt="Facebook" />
      </a>
      <a href="https://wa.me/14073690643" target="_blank" rel="noopener">
        <img src="whatsapp-icon.jpeg" alt="WhatsApp" />
      </a>
      <a href="https://www.instagram.com/mltorlando?igsh=ODV0Y2pocXJ0bjk4" target="_blank" rel="noopener">
        <img src="instagram-icon.jpeg" alt="Instagram" />
      </a>
    </div>

    © <span id="year"></span> MLT Orlando Transportation. All rights reserved.
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // --- Pricing and Square links mapping ---
    const OPTIONS = {
      MCO_DISNEY: {
        SEDAN: {
          ONEWAY: { price: 120, link: "https://square.link/u/ImApGXW4?src=sheet" },
          ROUND: { price: 220, link: "https://square.link/u/QHivT4tx?src=sheet" },
        },
        SUV: {
          ONEWAY: { price: 130, link: "YOUR_SQUARE_LINK_MCO_DISNEY_SUV_ONEWAY" },
          ROUND: { price: 240, link: "YOUR_SQUARE_LINK_MCO_DISNEY_SUV_ROUND" },
        },
        VAN8: {
          ONEWAY: { price: 150, link: "YOUR_SQUARE_LINK_MCO_DISNEY_VAN8_ONEWAY" },
          ROUND: { price: 280, link: "YOUR_SQUARE_LINK_MCO_DISNEY_VAN8_ROUND" },
        },
        VAN14: {
          ONEWAY: { price: 180, link: "YOUR_SQUARE_LINK_MCO_DISNEY_VAN14_ONEWAY" },
          ROUND: { price: 330, link: "YOUR_SQUARE_LINK_MCO_DISNEY_VAN14_ROUND" },
        },
      },
      MCO_PORT: {
        SEDAN: {
          ONEWAY: { price: 210, link: "YOUR_SQUARE_LINK_MCO_PORT_SEDAN_ONEWAY" },
          ROUND: { price: 400, link: "YOUR_SQUARE_LINK_MCO_PORT_SEDAN_ROUND" },
        },
        SUV: {
          ONEWAY: { price: 230, link: "YOUR_SQUARE_LINK_MCO_PORT_SUV_ONEWAY" },
          ROUND: { price: 440, link: "YOUR_SQUARE_LINK_MCO_PORT_SUV_ROUND" },
        },
        VAN8: {
          ONEWAY: { price: 260, link: "YOUR_SQUARE_LINK_MCO_PORT_VAN8_ONEWAY" },
          ROUND: { price: 500, link: "YOUR_SQUARE_LINK_MCO_PORT_VAN8_ROUND" },
        },
        VAN14: {
          ONEWAY: { price: 290, link: "YOUR_SQUARE_LINK_MCO_PORT_VAN14_ONEWAY" },
          ROUND: { price: 560, link: "YOUR_SQUARE_LINK_MCO_PORT_VAN14_ROUND" },
        },
      },
      SFB_DISNEY: {
        SEDAN: {
          ONEWAY: { price: 150, link: "YOUR_SQUARE_LINK_SFB_DISNEY_SEDAN_ONEWAY" },
          ROUND: { price: 280, link: "YOUR_SQUARE_LINK_SFB_DISNEY_SEDAN_ROUND" },
        },
        SUV: {
          ONEWAY: { price: 165, link: "YOUR_SQUARE_LINK_SFB_DISNEY_SUV_ONEWAY" },
          ROUND: { price: 310, link: "YOUR_SQUARE_LINK_SFB_DISNEY_SUV_ROUND" },
        },
        VAN8: {
          ONEWAY: { price: 185, link: "YOUR_SQUARE_LINK_SFB_DISNEY_VAN8_ONEWAY" },
          ROUND: { price: 350, link: "YOUR_SQUARE_LINK_SFB_DISNEY_VAN8_ROUND" },
        },
        VAN14: {
          ONEWAY: { price: 210, link: "YOUR_SQUARE_LINK_SFB_DISNEY_VAN14_ONEWAY" },
          ROUND: { price: 390, link: "YOUR_SQUARE_LINK_SFB_DISNEY_VAN14_ROUND" },
        },
      },
      HOURLY: {
        SUV: {
          HOURLY: { price: 90, link: "YOUR_SQUARE_LINK_HOURLY_SUV" }
        },
      },
    };

    const routeSelect = document.getElementById("route");
    const vehicleSelect = document.getElementById("vehicle");
    const tripTypeSelect = document.getElementById("trip-type");
    const pickupDateInput = document.getElementById("pickup-date");
    const pickupTimeInput = document.getElementById("pickup-time");
    const priceText = document.getElementById("price-text");
    const timingBanner = document.getElementById("timing-banner");
    const selectedOptionInput = document.getElementById("selected-option");
    const bookingForm = document.getElementById("booking-form");
    const routeVehicleCard = document.getElementById("route-vehicle-card");
    const submitBtn = document.getElementById("submit-btn");
    const formStatus = document.getElementById("form-status");

    // Return trip fields (shown only for ROUND)
    const returnCard = document.getElementById("return-details-card");
    const returnFrom = document.getElementById("return-from");
    const returnTo = document.getElementById("return-to");
    const returnDate = document.getElementById("return-date");
    const returnTime = document.getElementById("return-time");

    function syncReturnTripUI() {
      const isRound = (tripTypeSelect?.value === "ROUND");
      if (returnCard) returnCard.style.display = isRound ? "block" : "none";

      // Required only if round trip selected
      if (returnFrom) returnFrom.required = isRound;
      if (returnTo) returnTo.required = isRound;
      if (returnDate) returnDate.required = isRound;
      if (returnTime) returnTime.required = isRound;

      // Optional: clear values when not round trip (keeps form clean)
      if (!isRound) {
        if (returnFrom) returnFrom.value = "";
        if (returnTo) returnTo.value = "";
        if (returnDate) returnDate.value = "";
        if (returnTime) returnTime.value = "";
        const rn = document.getElementById("return-notes");
        if (rn) rn.value = "";
      }
    }

    // --- Child seats repeater ---
    const seatRows = document.getElementById("seat-rows");
    const addSeatRowBtn = document.getElementById("add-seat-row");
    const childSeatsSummary = document.getElementById("child-seats-summary");

    function updateSeatsSummary() {
      if (!seatRows || !childSeatsSummary) return;

      const rows = seatRows.querySelectorAll(".seat-row");
      const parts = [];

      rows.forEach((row) => {
        const type = row.querySelector(".seat-type")?.value || "";
        const qty = row.querySelector(".seat-qty")?.value || "";
        if (type && qty) parts.push(`${qty} × ${type}`);
      });

      childSeatsSummary.value = parts.length ? parts.join("; ") : "None selected";
    }

    function toggleSeatRemoveButtons() {
      if (!seatRows) return;
      const rows = seatRows.querySelectorAll(".seat-row");
      rows.forEach((row) => {
        const btn = row.querySelector(".seat-remove");
        if (btn) btn.style.display = rows.length > 1 ? "inline-block" : "none";
      });
    }

    function makeSeatRow() {
      const row = document.createElement("div");
      row.className = "seat-row";
      row.style.display = "grid";
      row.style.gridTemplateColumns = "1fr 90px 40px";
      row.style.gap = "0.5rem";
      row.style.alignItems = "center";
      row.style.marginTop = "0.5rem";

      row.innerHTML = `
        <select class="seat-type" name="Child seat type[]" aria-label="Seat type">
          <option value="">Select seat type</option>
          <option value="Rear-facing infant seat">Rear-facing infant seat</option>
          <option value="Forward-facing car seat">Forward-facing car seat</option>
          <option value="Booster seat">Booster seat</option>
        </select>

        <select class="seat-qty" name="Child seat quantity[]" aria-label="Quantity">
          <option value="">#</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
        </select>

        <button type="button" class="seat-remove btn-secondary" aria-label="Remove seat selection" style="padding:0.4rem 0.6rem;">
          ×
        </button>
      `;

      const typeEl = row.querySelector(".seat-type");
      const qtyEl = row.querySelector(".seat-qty");
      const removeBtn = row.querySelector(".seat-remove");

      typeEl.addEventListener("change", updateSeatsSummary);
      qtyEl.addEventListener("change", updateSeatsSummary);

      removeBtn.addEventListener("click", () => {
        row.remove();
        toggleSeatRemoveButtons();
        updateSeatsSummary();
      });

      return row;
    }

    if (addSeatRowBtn && seatRows) {
      seatRows.querySelectorAll(".seat-type, .seat-qty").forEach((el) => {
        el.addEventListener("change", updateSeatsSummary);
      });

      addSeatRowBtn.addEventListener("click", () => {
        seatRows.appendChild(makeSeatRow());
        toggleSeatRemoveButtons();
        updateSeatsSummary();
      });

      toggleSeatRemoveButtons();
      updateSeatsSummary();
    }

    function getPickupDateTime() {
      const dateValue = pickupDateInput.value;
      const timeValue = pickupTimeInput.value;
      if (!dateValue || !timeValue) return null;

      const dt = new Date(dateValue + "T" + timeValue);
      if (isNaN(dt.getTime())) return null;
      return dt;
    }

    // Keep current pay state here
    let currentSquareLink = null;
    let currentCanPayNow = false;

    function updatePriceAndLink() {
      const route = routeSelect.value;
      const vehicle = vehicleSelect.value;
      const tripType = tripTypeSelect.value;
      const pickupDateTime = getPickupDateTime();

      // Return details depend on trip type
      syncReturnTripUI();

      // Show route/vehicle section only after date + time are selected
      if (routeVehicleCard) {
        routeVehicleCard.style.display = pickupDateTime ? "block" : "none";
      }

      let timingLabel = "Pickup time not selected yet";
      let timingNote = "";
      let canPayNow = false;

      if (pickupDateTime) {
        const now = new Date();
        const diffMs = pickupDateTime - now;
        const diffHours = diffMs / (1000 * 60 * 60);

        if (diffHours < 8) {
          timingLabel = "Short notice (< 8 hours)";
          timingNote =
            " This trip is within the next 8 hours. Please submit this form as a request only and wait for our confirmation before making any payment.";
          canPayNow = false;
        } else {
          timingLabel = "Standard (≥ 8 hours)";
          timingNote =
            " This trip is more than 8 hours away. After submitting, you can complete payment (if a Square link is available for your option).";
          canPayNow = true;
        }

        timingBanner.textContent =
          "Pickup time check: " + timingLabel + ". " +
          (diffHours > 0
            ? "Approx. " + diffHours.toFixed(1) + " hours from now."
            : "Pickup time appears to be in the past or very soon. We will review it.");
      } else {
        timingBanner.textContent =
          "Once you select your pickup date and time, we’ll tell you if this is a short-notice request (< 8 hours) or a standard booking (≥ 8 hours).";
      }

      // Default pay state
      currentSquareLink = null;
      currentCanPayNow = false;

      // Custom route: no fixed price/link
      if (route === "CUSTOM") {
        priceText.textContent =
          "Custom route selected." +
          (timingNote
            ? timingNote + " We will review your details and send you the exact price and a Square payment link."
            : " We will review your details and send you the exact price and a Square payment link.");

        selectedOptionInput.value =
          "Custom route – price and Square link to be confirmed by MLT. Timing: " + timingLabel;

        if (submitBtn) submitBtn.textContent = pickupDateTime && !canPayNow
          ? "Submit booking request (request only)"
          : "Submit booking request";
        return;
      }

      if (!route || !vehicle || !tripType) {
        priceText.textContent =
          "Please select a route, vehicle and trip type to see the price and payment instructions." +
          (timingNote || "");
        selectedOptionInput.value = "";

        if (submitBtn) submitBtn.textContent = pickupDateTime && !canPayNow
          ? "Submit booking request (request only)"
          : "Submit booking request";
        return;
      }

      const routeData = OPTIONS[route];
      if (!routeData || !routeData[vehicle] || !routeData[vehicle][tripType]) {
        priceText.textContent =
          "We don't have a fixed price for that exact combination. Please describe your trip in the notes and we will confirm the price and send a Square link." +
          (timingNote || "");

        selectedOptionInput.value =
          "No fixed price: route=" + route + ", vehicle=" + vehicle +
          ", tripType=" + tripType + ". Timing: " + timingLabel;

        if (submitBtn) submitBtn.textContent = pickupDateTime && !canPayNow
          ? "Submit booking request (request only)"
          : "Submit booking request";
        return;
      }

      const option = routeData[vehicle][tripType];

      let tripLabel = "";
      if (tripType === "ONEWAY") tripLabel = "One-way";
      else if (tripType === "ROUND") tripLabel = "Round trip";
      else if (tripType === "HOURLY") tripLabel = "Hourly (3-hour minimum)";

      if (route === "HOURLY") {
        priceText.textContent =
          `Selected: Hourly SUV service within Orlando – ${tripLabel} at $${option.price} per hour (3-hour minimum).` +
          timingNote;
      } else {
        priceText.textContent =
          `Selected: ${tripLabel} ${vehicle} for ${route} – $${option.price}.` +
          timingNote;
      }

      const hasRealLink = option.link && !option.link.startsWith("YOUR_SQUARE_LINK_");
      currentCanPayNow = !!(canPayNow && hasRealLink);
      currentSquareLink = currentCanPayNow ? option.link : null;

      if (submitBtn) {
        if (currentCanPayNow && currentSquareLink) {
          submitBtn.textContent = "Submit booking request & Pay with Square";
        } else if (pickupDateTime && !canPayNow) {
          submitBtn.textContent = "Submit booking request (request only)";
        } else {
          submitBtn.textContent = "Submit booking request";
        }
      }

      selectedOptionInput.value =
        `Route: ${route}, Vehicle: ${vehicle}, Trip type: ${tripLabel}, Price: $${option.price}, ` +
        `Square link: ${option.link}, Timing: ${timingLabel}`;
    }

    routeSelect.addEventListener("change", updatePriceAndLink);
    vehicleSelect.addEventListener("change", updatePriceAndLink);
    tripTypeSelect.addEventListener("change", updatePriceAndLink);
    pickupDateInput.addEventListener("change", updatePriceAndLink);
    pickupTimeInput.addEventListener("change", updatePriceAndLink);

    // AJAX submit to Formspree, then (if allowed) redirect to Square
    bookingForm.addEventListener("submit", async function (e) {
      e.preventDefault();

      updateSeatsSummary();
      updatePriceAndLink(); // also syncs return UI & required rules

      if (formStatus) {
        formStatus.style.display = "none";
        formStatus.textContent = "";
      }

      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = "Sending...";
      }

      try {
        const formData = new FormData(bookingForm);

        const res = await fetch(bookingForm.action, {
          method: "POST",
          body: formData,
          headers: { "Accept": "application/json" }
        });

        if (!res.ok) {
          let msg = "Sorry—there was a problem sending your request. Please try again, or call/text us.";
          try {
            const data = await res.json();
            if (data && data.errors && data.errors.length) {
              msg = data.errors.map(e => e.message).join(" ");
            }
          } catch (_) {}

          if (formStatus) {
            formStatus.style.display = "block";
            formStatus.textContent = msg;
          }
        } else {
          if (currentCanPayNow && currentSquareLink) {
            window.location.href = currentSquareLink;
            return;
          }

          if (formStatus) {
            formStatus.style.display = "block";
            formStatus.textContent =
              "Request sent! We’ll confirm availability and follow up by email/text.";
          }

          bookingForm.reset();
          toggleSeatRemoveButtons();
          updateSeatsSummary();
          updatePriceAndLink();
        }
      } catch (err) {
        if (formStatus) {
          formStatus.style.display = "block";
          formStatus.textContent =
            "Network error—please check your connection and try again, or call/text us.";
        }
      } finally {
        if (submitBtn) {
          submitBtn.disabled = false;
          updatePriceAndLink();
        }
      }
    });

    // Initialize UI state on load
    updatePriceAndLink();
    updateSeatsSummary();
  </script>
</body>
</html>
