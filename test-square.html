<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Square Test</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 24px; }
    .box { max-width: 520px; }
    input, button { width: 100%; padding: 12px; font-size: 16px; margin-top: 10px; }
    .status { margin-top: 12px; padding: 10px; background:#f3f4f6; border-radius: 10px; }
    a { word-break: break-all; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Square Payment Link Test</h2>

    <label>Amount (USD)</label>
    <input id="amount" type="number" value="10" min="1" step="1" />

    <button id="btn">Create Payment Link</button>

    <div class="status" id="status">Status: idle</div>
    <div id="out"></div>
  </div>

  <script>
    const statusEl = document.getElementById("status");
    const outEl = document.getElementById("out");
    const btn = document.getElementById("btn");

    btn.addEventListener("click", async () => {
      outEl.innerHTML = "";
      statusEl.textContent = "Status: creating link...";
      btn.disabled = true;

      try {
        const amount = Number(document.getElementById("amount").value);

        const resp = await fetch("/api/create-square-link", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ amount, currency: "USD", name: "Prod Test", note: "Test" })
        });

        const data = await resp.json().catch(() => ({}));

        if (!resp.ok || !data.ok) {
          console.error("API error:", data);
          alert("Square / API error (check Console + Network Response)");
          statusEl.textContent = "Status: error (open Console)";
          return;
        }

        statusEl.textContent = "Status: success!";
        outEl.innerHTML = `<p><b>Payment Link:</b> <a href="${data.url}" target="_blank" rel="noopener">${data.url}</a></p>`;
      } catch (e) {
        console.error(e);
        alert("Failed to fetch (check Console / Network)");
        statusEl.textContent = "Status: FAILED TO FETCH";
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
